---
title: "Atividade prática n. 2"
author: "Grupo 9"
date: "04 de outubro de 2022"
output:
  html_document: default
  pdf_document:
    keep_tex: yes
  word_document: default
editor_options: 
  markdown: 
    wrap: 72
---

**Relatório do grupo 9**

Tema: *relatório completo sobre investimento em empresas estatais*

## Questão 0:

Iniciando os modulos, os dados para as analises e as funções necessarias

```{r, message = FALSE}
#install.packages("stargazer")
library(stargazer)
```

## Questão 1:

Baixe o relatório e declare no R que a coluna Data contém informações
temporais.

```{r}
data <- read.csv("ArquivoExercicio2.csv",sep=";",header=TRUE)

data$Data <- as.Date(data$Data)
```

## Questão 2:

Crie no R gráficos com os retornos dos 3 ativos ao longo do tempo.
Analise os resultados dando destaque ao período da pandemia de COVID-19.

Graficos da BBSA3

```{r}
plot(data$Data,data$BBSA3,col="Blue",
     main = "Retorno por dia da BBSA3")
abline(v=18320,col="Red")
```

Graficos da PETR4

```{r}
plot(data$Data,data$PETR4,col="Blue",
     main = "Retorno por dia da PETR4")
abline(v=18320,col="Red")
```

Graficos da CMIG4

```{r}
plot(data$Data,data$CMIG4,col="Blue",
     main = "Retorno por dia da CMIG4")
abline(v=18320,col="Red")
```
  * Data inicial da pandemia indicada pela linha vermelha (2020-03-01)
  Podemos observar que as três empresas apresentavam retornos relativamente constantes e não muito dispersos. Particularmente, a Petrobrás é a  que apresenta um retorno mais centrado no 0, enquanto a Cemig e o Banco do Brasil apresentam retornos um pouco mais dispersos, mas também perto do 0. Agora, na época da pandemia do Covid-19, podemos observar uma grande dispersão dos retornos, formando quase uma linha vertical no gráfico, o que indica que os retornos foram mais inconstantes nesse período inicial da pandemia. Agora, como as duas empresas são muito consistentes no mercado, pouco tempo depois da pandemia, elas já voltaram a ter retornos mais pre-pandemia.

## Questão 3:

Estime o excesso de retornos dos 3 ativos.

```{r}
ativos <- c("BBSA3","PETR4","CMIG4")
estatisticas <- c("Minimo","Media","Maximo","Desvio Padrao")

excessos <- matrix(,nrow=547,ncol=3)
colnames(excessos) <- ativos

for (ativo in ativos){
  excessos[,ativo] <- data[,ativo] - data$RF
}

rownames(excessos) <- data$Data

output <- matrix(,nrow=4,ncol=3)
colnames(output) <- ativos
rownames(output) <- estatisticas

for (ativo in ativos){
  output["Minimo",ativo] <- min(excessos[,ativo])
  output["Media",ativo] <- median(excessos[,ativo])
  output["Maximo",ativo] <- max(excessos[,ativo])
  output["Desvio Padrao",ativo] <- sd(excessos[,ativo])
}
output
```

## Questão 4:

Para cada uma das ações, estime o modelo CAPM e analise do ponto de vista
econométrico e financeiro os coeficientes A e B estimados
### Ativo BBSA3
```{r}
CAPM_BBSA3 <- lm(BBSA3 ~ MKT,data = data)
```
  De acordo com o modelo, o alfa tem valor numérico de -0,0011616. Entretanto, o seu P-valor é de 10,80%, o que significa que o alfa tem mais que 5% de chance de pertencer a uma normal com média 0, o que pode fazer com que ele seja insignificante. Porém, caso ele tivesse valor significativo, financeiramente ele indicaria o retorno da empresa que não depende da variável analisada. Já o ativo beta tem valor numérico igual a 1,295843 e um P-valor bem menor do que 5%, o que faz com que o seu valor seja significativo para o modelo. O beta, por sua vez, indica a volatilidade do mercado, e, por ser maior que 1, indica que o ativo é mais volátil que o mercado. Alem do mais, uma variação positiva do mercado indica que o ativo tende a variar positivamente.
### Ativo PETR4
```{r}
CAPM_PETR4 <- lm(PETR4 ~ MKT,data = data)
```
  Analisando esse ativo, o alfa tem valor numérico de -0.0008972. Porém, o seu P-valor também é bem alto, de 43,3%, o que significa que o alfa tem mais que 5% de chance de pertencer a uma normal com média 0, o que pode faz com que ele seja insignificante. Agora, caso tivesse valor significativo no modelo, financeiramente ele indicaria o retorno da empresa que não depende da variável analisada. Já o ativo beta tem valor numérico igual a 1,4451268 e um P-valor bem menor do que 5%, o que faz com que o seu valor seja significativo para o modelo. O beta, por sua vez indica a volatilidade do mercado, e, por ser, mais uma vez maior que 1, indica que o ativo é mais volátil que o mercado. Com uma variação positiva do mercado, o modelo indica que a variavel analisada tende a variar mais.

### Ativo CMIG4 
```{r}
CAPM_CMIG4 <- lm(CMIG4 ~ MKT,data = data)
```
  Já na Cemig, o alfa tem valor numérico de -0,0003041, mas mais uma vez possui um P-valor superior à 5%, o que faz com que ele seja insignificante. Agora, caso tivesse valor significativo, indicaria o retorno da empresa que não depende da variável analisada. Já o ativo beta tem valor numérico igual a 1,0754770 e um P-valor inferior à 5%, o que indica, mais uma vez, que o ativo é mais volátil que o mercado, mas menos que os outros ativos.

## Questão 5:

Analise o poder explicativos dos modelos.

  O poder explicativo dos modelos pode ser avaliado a partir do R quadrado de cada modelo, já que estamos lidando com uma regressão linear de uma unica variavel. Desse modo, o modelo do ativo BBSA3 possui um R quadrado de 0,7087, o que significa que 70,87% da variável é explicada pelo modelo. Já no ativo PETR4 o R-quadrado vale 0,5449, o que significa que 54,49% da variável é explicada pelo modelo. Por fim, o ativo CMIG4 possui um R-quadrado de 0,6362, que significa que 63,62% da variável é explicada pelo modelo.
  
## Questão 6:

  Estime o modelo proposto por Fama-French-Carhart para as 3 ações e analise os
resultados, cuja especificação se encontra abaixo:

### BBSA3
```{r}
modelo_FFC_BBSA3 <- lm(BBSA3 - RF ~ MKT + SMB + HML,data=data)
```

### PETR4
```{r}
modelo_FFC_PETR4 <- lm(PETR4 - RF ~ MKT + SMB + HML,data=data)
```

### CMIG4
```{r}
modelo_FFC_CMIG4 <- lm(CMIG4 - RF ~ MKT + SMB + HML,data=data)
```

## Questão 7:
  Estime agora o modelo de Fama-French e o de Fama-French-Carhart para explicar
os retornos do portfólio. Monte uma tabela comparativa entre modelo CAPM e os
2 modelos gerados e analise os resultados. O modelo de Fama-French tem a
seguinte especificação
### Iniciando os modelos
```{r}
modelo_FF_BBSA3 <- lm(BBSA3 - RF ~ MKT + SMB + HML,data=data)

modelo_FF_PETR4 <- lm(PETR4 - RF ~ MKT + SMB + HML,data=data)

modelo_FF_CMIG4 <- lm(CMIG4 - RF ~ MKT + SMB + HML,data=data)
```


### BBSA3
```{r}
stargazer(CAPM_BBSA3,modelo_FFC_BBSA3,modelo_FF_BBSA3, type = "html", title = "Comparação de regressões - BBSA3",
          column.labels=c("CAPM","Fama-French-Carhart","Fama-French"),
          dep.var.labels.include=F)
```

### PETR4
```{r}
stargazer(CAPM_PETR4,modelo_FFC_PETR4,modelo_FF_PETR4, type = "html", title = "Comparação de regressões - PETR4",
          column.labels=c("CAPM","Fama-French-Carhart","Fama-French"),
          dep.var.labels.include=F)
```

### CMIG4
```{r}
stargazer(CAPM_CMIG4,modelo_FFC_CMIG4,modelo_FF_CMIG4, type = "html", title = "Comparação de regressões - CMIG4",
          column.labels=c("CAPM","Fama-French-Carhart","Fama-French"),
          dep.var.labels.include=F)

```

## Creditos: 
*Hlavac, Marek (2018). stargazer: Well-Formatted Regression and Summary Statistics Tables.*